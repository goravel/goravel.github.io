# الترقية إلى v1.14 من v1.13

### مميزات جديدة مثيرة 🎉

- [Localization](#localization)
- [Installer](#installer)
- [Cookie](#cookie)
- [Session](#session)

### تعزيز 🚀

- [دعم لتعيين body_limit و header_limit في محركات البنزين والألياف الأليفية](#support-for-setting-body-limit-and-header-limit-in-gin-and-fiber-drivers)
- [السجل يضيف طرق جديدة](#log-adds-new-methods)
- [يضيف النظام أساليب جديدة](#orm-adds-new-methods)
- [وحدة التحكم تضيف طرق جديدة](#console-adds-new-methods)
- [الرد يضيف طرق جديدة](#response-adds-new-methods)
- [إضافة أمر البناء](#add-build-command)
- [إضافة طرق المساعد](#add-helper-methods)
- [مشغل Redis يدعم TLS](#redis-driver-supports-tls)

### كسر التغييرات 🛠️

- [التحقق لن يربط البيانات إذا فشلت عملية التحقق](#validation-will-not-bind-data-if-validation-fails)
- [إضافة طرق جديدة وتعديل طرق لاختبار الوحدة](#add-new-methods-and-modify-methods-for-testing-module)
- [تحسين طريقة قائمة الانتظار من البريد](#optimize-the-queue-method-of-mail)
- [تحسين طريقة الإعداد لوحدة المصادقة ctx](#optimize-the-setting-method-of-the-auth-module-ctx)
- [تحسين طريقة الوجوه الوهمية](#optimize-the-way-of-mock-facades)
- [Framework Orm model Adds json tag](#framework-orm-model-adds-json-tag)

### v1.14.1

- [إصلاح الجلسة لم يتم تعيينها بنجاح في مشغل الهامش](#fix-the-session-is-not-set-successfully-in-the-gin-driver)
- [إصلاح ملف اللغة لا يمكن قراءته في وحدة التعريب ](#fix-the-language-file-cannot-be-read-in-the-localization-module)

### v1.14.2

- [فشلت عملية التحقق من صحة الصورة والملف] (#fix-validation-verification-of-image-and-file-failed)
- [إصلاح ملف تعريف الارتباط ينتهي مفعّل Goravel/gin غير صالح](#fix-the-cookie-expires-set-by-the-goravel-gin-driver-is-invalid)

### v1.14.3

ترقية الطرود ذات الصلة: goravel/gin: v1.2.2, goravel/fiber: v1.2.2

- [إصلاح التحقق لا يمكن ربط شريحة](#fix-validation-cannot-bind-slice)
- [التحقق يدعم ربط الكربون](#validation-supports-bind-carbon)

### v1.14.4

ترقية الحزم ذات الصلة: Goravel/gin: v1.2.3

- [إصلاح مشكلة الدورة المتزامنة](#fix-session-concurrent-problem)
- [إصلاح مجموعات Gin الجلسة نفس_الموقع غير صالح](#fix-gin-sets-session-same_site-invalid)

### v1.14.5

ترقية الطرود ذات الصلة: goravel/gin: v1.2.4, goravel/fiber: v1.2.3

- [إضافة طريقة إيقاف تشغيل للطريق](#add-shutdown-method-for-route)

### v1.14.7

ترقية الطرود ذات الصلة: goravel/gin: v1.2.5, goravel/fiber: v1.2.4

- [تحسين طريقة ctx.WithValue من HTTP](#optimize-the-ctx-withvalue-method-of-http)

### v1.14.8

- [اصلاح مشكلة تسجيل المستمعين المتعارضة](#fix-the-problem-of-conflicting-listener-registration)

### v1.14.9

- [إصلاح مشكلة وحدة تحكم مشغل السجل المخصص مرارا وتكرارا](#fix-the-problem-of-custom-log-driver-console-repeatedly-printing)
- [إصلاح مشكلة خطأ ربط البيانات عندما يحتوي طلب JSON HTTP على بنية متعددة المستويات](#fix-the-problem-of-data-binding-error-when-http-json-request-contains-multi-level-structure)

## دليل الترقية

ويجري تطوير واختبار غورافيل v1.14 استنادا إلى جولانغ 1-21 ومتوافقة عموما مع نسخ أخرى أسفل من الجولانغ.
الرجاء ترقية الإطار خطوة بخطوة وفقا للمحتوى في هذا القسم.

**الوقت التقديري للترقية: 10 دقائق**

### 1. تحديث التبعيات

```
اذهب للحصول على -u github.com/goravel/framework@v1.14.7

// اذا استخدم الهامش
اذهب للحصول على -u github.com/goravel/gin@v1.2.5

// اذا استخدم الألياف
اذهب للحصول على -u github. om/goravel/fiber@v1.2.4

// إذا استخدم redis
اذهب للحصول على -u github.com/goravel/redis@v1.2.1

// إذا استخدم s3
اذهب للحصول على -u github.com/goravel/s3@v1. .0

// إذا استخدم os
اذهب للحصول على -u github.com/goravel/oss@v1.2.0

// إذا استخدم cos
اذهب للحصول على -u github.com/goravel/cos@v1.2.

// إذا كان استخدام المصغر
اذهب للحصول على -u github.com/goravel/minio@v1.2.0

// إذا كان استخدام Cloudinay
اذهب للحصول على -u github.com/goravel/cloudinary@v1.2.0

اذهب إلى موديل المد
```

### 2. إضافة عناصر الإعدادات

1. 'config/app.go' يضيف عناصر تكوين وحدة التعريب :

```go
"locale": "en",
"fallback_locale": "en",
"مقدمي الخدمات": []foundation.ServiceProvider{
  ...
  &session.ServiceProvider{},
  &translation.ServiceProvider{},
  ...
}
```

2. إذا كنت ترغب في استخدام ميزة \`الدورة'، أضف الملف
 [config/session.go](https://github.com/goravel/goravel/blob/master/config/session.go)؛

### 3) إذا كنت تستخدم وحدة التحقق

تأكيد ما إذا كنت لا تزال تحاول قراءة قيمة الربط حتى إذا فشلت عملية التحقق من البيانات. إذا كان الأمر كذلك، تحتاج إلى
تحسين المنطق، لأن القيمة فارغة بعد الترقية.
انظر: [التحقق لن يربط البيانات إذا فشلت عملية التحقق](#validation-will-not-bind-data-if-validation-fails).

### 4. إذا كنت تستخدم وحدة الاختبار

تحقق مما إذا كان استخدام طرق 'Cle\`, 'Image' ، إذا كان الأمر كذلك ، بحاجة إلى تعديل
تبعاً لذلك: [إضافة طرق جديدة وتعديل طرق لاختبار الوحدة](#add-new-methods-and-modify-methods-for-testing-module)

### 5. إذا كنت تستخدم وحدة البريد

تحقق مما إذا كان استخدام طريقة "قائمة الإنتظار"، إذا كان الأمر كذلك، يحتاج إلى تعديل
تبعاً لذلك: [تحسين طريقة قائمة الإنتظار من البريد](#optimize-the-queue-method-of-mail)

### 6. إذا كنت تستخدم وحدة المصادقة

الحاجة إلى تعديل
تبعاً لذلك: [تحسين طريقة إعداد وحدة المصادقة ctx](#optimize-the-setting-method-of-the-auth-module-ctx)

### 7. إذا استخدمت الواجهات الوهمية

الحاجة إلى التعديل تبعاً لذلك: [تحسين طريقة الوجوه الوهمية](#optimize-the-way-of-mock-facades)

### 8. في حالة استخدام نموذج Orm الإطاري وإعادة البيانات مباشرة من خلال نقطة النهاية

الحاجة إلى تعديل تبعاً لذلك: [Framework Orm model adds json tag](#framework-orm-model-adds-json-tag)

## مقدمة الميزة

### التعريب

الإصدار: v1.14.0

[عرض الوثائق](../advanced/localization)

### المثبت

الإصدار: v1.14.0

يسمح لك المثبت بتنزيل وتجهيز مشروع جورافيل الجديد.

[عرض الوثائق](http://github.com/goravel/installer)

### كوكي

الإصدار: v1.14.0

[عرض وثيقة الطلب](../basic/requests#cookie)

[عرض وثيقة الرد] (../basic/responses#cookie)

### الجلسة

الإصدار: v1.14.0

[عرض الوثائق](../basic/session)

### دعم تعيين حد الجسم والرأس في مشغلات الجينات والألياف

الإصدار: v1.14.0

HTTP drivers support setting body_limit to limit the body size,
see: [goravel/gin](https://github.com/goravel/gin/blob/c9d7706a6a04c05c8c33af5c97877a1ad2ea6362/README.md?plain=1#L54)
and [goravel/fiber](https://github.com/goravel/fiber/blob/aa63ab657cd2b371fcda4df0090a41226f6c0704/README.md?plain=1#L56).

### Log adds new methods

الإصدار: v1.14.0

| الطريقة     | Descrpton                              |
| ----------- | -------------------------------------- |
| `Stack`     | Use multiple channels at the same time |
| `Channel`   | Specified a channel                    |
| `WithTrace` | Print trace                            |

[View Documentation](../basic/logging#write-to-a-specific-channel)

### النظام يضيف طرق جديدة

الإصدار: v1.14.0

Add `WhereIn`, `OrWhereIn`, `OrWhereNotIn`, `WhereNotIn`, `WhereBetween`, `WhereNotBetween`, `WhereNull`, `OrWhereNull`,
`OrderByDesc`, `OrderBy`, `InRandomOrder`, `Exists` methods.

### Console adds new methods

الإصدار: v1.14.0

[View Documentation](../advanced/artisan#prompting-for-input)

### Response adds new methods

الإصدار: v1.14.0

[View documentation](../basic/responses#no-content)

### Add Build command

الإصدار: v1.14.0

The Goravel project can be compiled with the following command: `go run . artisan build`.

[View Documentation](../quickstart/compile#compile-command)

### Add helper methods

الإصدار: v1.14.0

- [Str](../advanced/strings)
- [Map](../advanced/helpers#maps)
- [Color](../advanced/color)
- [Convert](../advanced/helpers#convert)
- [Collect](../advanced/helpers#collect)

### Redis driver supports TLS

الإصدار: v1.14.0

[View Documentation](https://github.com/goravel/redis)

### Validation will not bind data if validation fails

الإصدار: v1.14.0

Previously, when calling the methods below, the `userRequest` still bound the value, even if an error was returned.
After the upgrade, it will no longer bind.

```go
var userRequest requests.UserRequest
errors, err := ctx.Request().ValidateRequest(&userRequest)

// or
validator, err := validation.Make(***)
err = validator.Bind(&userRequest)
```

### Add new methods and modify methods for Testing module

الإصدار: v1.14.0

1. Add [Fresh](../testing/quickstart#refresh-database) method;
2. Modify `Clear` method to [Stop](../testing/quickstart#uninstall-image) method;
3. The `Image` method adds `ExposedPorts` variable and remove `Timeout` variable;

```go
database, err := facades.Testing().Docker().Database()
database.Image(testingcontract.Image{
  Repository: "mysql",
  Tag:        "5.7",
  Env: []string{
    "MYSQL_ROOT_PASSWORD=123123",
    "MYSQL_DATABASE=goravel",
  },
  -- Timeout: 1000,
  ++ ExposedPorts: []string{"3306"},
})
```

### Optimize the Queue method of Mail

الإصدار: v1.14.0

The input parameter of the `Queue` method changes from `queue *mail.Queue` to `queue ...mail.Queue`.

```diff
-- facades.Mail().Queue(nil)
++ facades.Mail().Queue()

-- facades.Mail().Queue(&mail.Queue{})
++ facades.Mail().Queue(mail.Queue{})
```

### Optimize the setting method of the Auth module ctx

الإصدار: v1.14.0

Previously, when calling the `Parse`, `User`, `Login`, `LoginUsingID`, `Refresh`, `Logout` methods, you need to pass
`ctx`. After the upgrade, you no longer need to pass `ctx`, you can directly set it in `facades.Auth(ctx)`.

```diff
-- facades.Auth().Parse(ctx, token)
++ facades.Auth(ctx).Parse(token)

-- facades.Auth().User(ctx, &user)
++ facades.Auth(ctx).User(&user)

-- facades.Auth().Login(ctx, &user)
++ facades.Auth(ctx).Login(&user)

-- facades.Auth().LoginUsingID(ctx, id)
++ facades.Auth(ctx).LoginUsingID(id)

-- facades.Auth().Refresh(ctx)
++ facades.Auth(ctx).Refresh()

-- facades.Auth().Logout(ctx)
++ facades.Auth(ctx).Logout()
```

### Optimize the way of mock facades

الإصدار: v1.14.0

```diff
import github.com/goravel/framework/testing/mock

++ mockFactory := mock.Factory()

-- app := mock.App()
++ app := mockFactory.App()

-- artisan := mock.Artisan()
++ artisan := mockFactory.Artisan()

-- auth := mock.Auth()
++ auth := mockFactory.Auth()

-- artisan := mock.Artisan()
++ artisan := mockFactory.Artisan()

-- cache, driver, lock := mock.Cache()
++ cache := mockFactory.Cache()
++ driver := mockFactory.CacheDriver()
++ lock := mockFactory.CacheLock()

-- config := mock.Config()
++ config := mockFactory.Config()

-- crypt := mock.Crypt()
++ crypt := mockFactory.Crypt()

-- event, task := mock.Event()
++ event := mockFactory.Event()
++ event := mockFactory.EventTask()

-- gate := mock.Gate()
++ gate := mockFactory.Gate()

-- grpc := mock.Grpc()
++ grpc := mockFactory.Grpc()

-- hash := mock.Hash()
++ hash := mockFactory.Hash()

-- mock.Log()
++ mockFactory.Log()

-- mail := mock.Mail()
++ mail := mockFactory.Mail()

-- orm, query, transaction, association := mock.Orm()
++ orm := mockFactory.Orm()
++ query := mockFactory.OrmQuery()
++ transaction := mockFactory.OrmTransaction()
++ association := mockFactory.OrmAssociation()

-- queue, task := mock.Queue()
++ queue := mockFactory.Queue()
++ task := mockFactory.QueueTask()

-- rateLimiter := mock.RateLimiter()
++ rateLimiter := mockFactory.RateLimiter()

-- storage, driver, file := mock.Storage()
++ storage := mockFactory.Storage()
++ driver := mockFactory.StorageDriver()
++ file := mockFactory.StorageFile()

-- seeder := mock.Seeder()
++ seeder := mockFactory.Seeder()

-- validation, validator, errors := mock.Validation()
++ validation := mockFactory.Validation()
++ validator := mockFactory.ValidationValidator()
++ errors := mockFactory.ValidationErrors()

-- view := mock.View()
++ view := mockFactory.View()
```

### Framework Orm model adds json tag

الإصدار: v1.14.0

If you are using the framework's Orm model and returning data directly through the endpoint, you need to create a new
model according to the old and replace the old, or frontend needs to modify the field name according to the json tag.

```go
type Model struct {
 -- ID uint `gorm:"primaryKey"`
 ++ ID uint `gorm:"primaryKey" json:"id"`
 Timestamps
}

type SoftDeletes struct {
 -- DeletedAt gorm.DeletedAt `gorm:"column:deleted_at"`
 ++ DeletedAt gorm.DeletedAt `gorm:"column:deleted_at" json:"deleted_at"`
}

type Timestamps struct {
 -- CreatedAt carbon.DateTime `gorm:"autoCreateTime;column:created_at"`
 -- UpdatedAt carbon.DateTime `gorm:"autoUpdateTime;column:updated_at"`
 ++ CreatedAt carbon.DateTime `gorm:"autoCreateTime;column:created_at" json:"created_at"`
 ++ UpdatedAt carbon.DateTime `gorm:"autoUpdateTime;column:updated_at" json:"updated_at"`
}
```

### Fix the session is not set successfully in the gin driver

goravel/framework: v1.14.1

### Fix the language file cannot be read in the localization module

goravel/framework: v1.14.1

### Fix Validation verification of image and file failed

goravel/framework: v1.14.2

goravel/gin: v1.2.2

goravel/fiber: v1.2.2

[Issue #450](https://github.com/goravel/goravel/issues/450)

### Fix the cookie Expires set by the goravel/gin driver is invalid

goravel/gin: v1.2.2

### Fix Validation cannot bind slice

goravel/framework: v1.14.3

```go
type User struct {
 Tags   []string `form:"tags" json:"tags"`
}
```

### Validation supports bind carbon

goravel/framework: v1.14.3

```go
// Define carbon field
type User struct {
 Date   carbon.Carbon `form:"date" json:"date"`
}
var user requests.User

// Use ValidateRequest bind data
errors, err := ctx.Request().ValidateRequest(&user)

// or use Validate bind data
validator, err := ctx.Request().Validate(map[string]string{
  "date": "required|date",
})
err := validator.Bind(&user)

// get date time
user.Date.ToDateTimeString()
```

### Fix Session concurrent problem

goravel/framework: v1.14.4

When the Session concurrency is too high, there may be a problem of Session read and write conflicts.

### Fix Gin sets Session same_site invalid

goravel/gin: v1.2.3

[Issue #455](https://github.com/goravel/goravel/issues/455)

### Add Shutdown method for Route

goravel/framework: v1.14.5

goravel/gin: v1.2.4

goravel/fiber: v1.2.3

[Document](../basic/routing#shutdown)

### Optimize the ctx.WithValue method of HTTP

goravel/framework: v1.14.7

goravel/gin: v1.2.5

goravel/fiber: v1.2.4

The `key` of the `ctx.WithValue` method is changed from only supporting the `string` type to supporting the `any` type.

```go
ctx.WithValue("Hello", "world")
ctx.WithValue(1, "hi")

var key struct{}
ctx.WithValue(key, "hola")
```

### Fix the problem of conflicting listener registration

goravel/framework: v1.14.8

Multiple events use the same listener, a listener conflict will be prompted when registering.

[Issue #523](https://github.com/goravel/goravel/issues/523)

### Fix the problem of custom Log driver console repeatedly printing

goravel/framework: v1.14.9

[Issue #531](https://github.com/goravel/goravel/issues/531)

### Fix the problem of data binding error when HTTP JSON Request contains multi-level structure

goravel/framework: v1.14.9

[Issue #533](https://github.com/goravel/goravel/issues/533)
